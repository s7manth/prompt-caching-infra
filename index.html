<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt Caching Infrastructure</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Monaco", "Courier New", monospace;
        background-color: #0a0a0a;
        color: #00ff00;
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 10px;
        border-bottom: 2px solid #00ff00;
        padding-bottom: 10px;
      }

      .subtitle {
        color: #888;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .section {
        margin-bottom: 30px;
        border: 1px solid #333;
        padding: 20px;
        background-color: #0f0f0f;
      }

      .section-title {
        font-size: 18px;
        margin-bottom: 15px;
        color: #00ff00;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #888;
        font-size: 12px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        background-color: #1a1a1a;
        border: 1px solid #333;
        color: #00ff00;
        font-family: "Monaco", "Courier New", monospace;
        font-size: 14px;
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #00ff00;
      }

      button {
        padding: 10px 20px;
        background-color: #1a1a1a;
        border: 2px solid #00ff00;
        color: #00ff00;
        cursor: pointer;
        font-family: "Monaco", "Courier New", monospace;
        font-size: 14px;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      button:hover {
        background-color: #00ff00;
        color: #0a0a0a;
      }

      button:active {
        transform: scale(0.98);
      }

      .response-box {
        background-color: #1a1a1a;
        border: 1px solid #333;
        padding: 15px;
        margin-top: 15px;
        min-height: 100px;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 13px;
      }

      .metric {
        display: inline-block;
        margin-right: 20px;
        margin-bottom: 10px;
      }

      .metric-label {
        color: #888;
        font-size: 11px;
      }

      .metric-value {
        color: #00ff00;
        font-size: 16px;
        font-weight: bold;
      }

      .cache-hit {
        color: #00ff00;
      }

      .cache-miss {
        color: #ff6600;
      }

      .error {
        color: #ff0000;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .stat-card {
        background-color: #1a1a1a;
        border: 1px solid #333;
        padding: 15px;
        text-align: center;
      }

      .loading {
        color: #ffff00;
      }

      .endpoint-info {
        background-color: #1a1a1a;
        border-left: 3px solid #00ff00;
        padding: 10px 15px;
        margin-bottom: 10px;
        font-size: 13px;
      }

      .endpoint-method {
        color: #ffff00;
        font-weight: bold;
      }

      .endpoint-path {
        color: #00ff00;
      }

      .small-input {
        width: 150px;
        display: inline-block;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>PROMPT CACHING INFRASTRUCTURE</h1>
      <p class="subtitle">
        Cloudflare AI Gateway | Vector Search | Multi-Provider Support
      </p>

      <!-- API Endpoints -->
      <div class="section">
        <div class="section-title">&gt; AVAILABLE ENDPOINTS</div>
        <div class="endpoint-info">
          <span class="endpoint-method">GET</span>
          <span class="endpoint-path">/health</span>
          <span style="color: #888"> - Health check</span>
        </div>
        <div class="endpoint-info">
          <span class="endpoint-method">GET</span>
          <span class="endpoint-path">/stats</span>
          <span style="color: #888"> - Cache statistics</span>
        </div>
        <div class="endpoint-info">
          <span class="endpoint-method">POST</span>
          <span class="endpoint-path">/chat</span>
          <span style="color: #888"> - Send prompt (with caching)</span>
        </div>
      </div>

      <!-- Chat Interface -->
      <div class="section">
        <div class="section-title">&gt; CHAT REQUEST</div>

        <label>API ENDPOINT URL</label>
        <input
          type="text"
          id="apiUrl"
          value="http://localhost:8787"
          placeholder="http://localhost:8787"
        />

        <label>PROMPT</label>
        <textarea id="prompt" placeholder="What is Cloudflare?">
What is Cloudflare?</textarea
        >

        <label>MODEL</label>
        <select id="model">
          <optgroup label="Workers AI">
            <option value="@cf/meta/llama-3.1-8b-instruct">
              @cf/meta/llama-3.1-8b-instruct
            </option>
            <option value="@cf/meta/llama-2-7b-chat-int8">
              @cf/meta/llama-2-7b-chat-int8
            </option>
          </optgroup>
          <optgroup label="OpenAI">
            <option value="gpt-4o-mini">gpt-4o-mini</option>
            <option value="gpt-4o">gpt-4o</option>
            <option value="gpt-4">gpt-4</option>
            <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
          </optgroup>
          <optgroup label="Anthropic">
            <option value="claude-3-5-sonnet-20241022">
              claude-3-5-sonnet-20241022
            </option>
            <option value="claude-3-opus-20240229">
              claude-3-opus-20240229
            </option>
            <option value="claude-3-haiku-20240307">
              claude-3-haiku-20240307
            </option>
          </optgroup>
          <optgroup label="Google">
            <option value="gemini-1.5-flash">gemini-1.5-flash</option>
            <option value="gemini-1.5-pro">gemini-1.5-pro</option>
          </optgroup>
        </select>

        <div>
          <label>MAX TOKENS</label>
          <input type="number" id="maxTokens" value="150" class="small-input" />

          <label>TEMPERATURE</label>
          <input
            type="number"
            id="temperature"
            value="0.7"
            step="0.1"
            min="0"
            max="2"
            class="small-input"
          />
        </div>

        <button onclick="sendChatRequest()">SEND REQUEST</button>
        <button onclick="clearResponse()">CLEAR</button>

        <div id="chatMetrics"></div>
        <div id="chatResponse" class="response-box"></div>
      </div>

      <!-- Stats Section -->
      <div class="section">
        <div class="section-title">&gt; CACHE STATISTICS</div>
        <button onclick="getStats()">REFRESH STATS</button>
        <button onclick="checkHealth()">CHECK HEALTH</button>
        <div id="statsContent" class="stats-grid"></div>
      </div>

      <!-- Recent Requests Log -->
      <div class="section">
        <div class="section-title">&gt; REQUEST LOG</div>
        <div id="requestLog" class="response-box">No requests yet...</div>
      </div>
    </div>

    <script>
      let requestLog = [];

      async function sendChatRequest() {
        const apiUrl = document.getElementById("apiUrl").value;
        const prompt = document.getElementById("prompt").value;
        const model = document.getElementById("model").value;
        const maxTokens = parseInt(document.getElementById("maxTokens").value);
        const temperature = parseFloat(
          document.getElementById("temperature").value
        );

        const responseDiv = document.getElementById("chatResponse");
        const metricsDiv = document.getElementById("chatMetrics");

        responseDiv.innerHTML =
          '<span class="loading">SENDING REQUEST...</span>';
        metricsDiv.innerHTML = "";

        const startTime = performance.now();
        const requestBody = {
          prompt,
          model,
          max_tokens: maxTokens,
          temperature,
        };

        try {
          const response = await fetch(`${apiUrl}/chat`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(requestBody),
          });

          const endTime = performance.now();
          const responseTime = (endTime - startTime).toFixed(0);
          const data = await response.json();

          const responseSize = new Blob([JSON.stringify(data)]).size;

          // Display metrics
          const cacheStatus = data.cached ? "HIT" : "MISS";
          const cacheClass = data.cached ? "cache-hit" : "cache-miss";

          let metricsHTML = `
          <div class="metric">
            <div class="metric-label">RESPONSE TIME</div>
            <div class="metric-value">${responseTime}ms</div>
          </div>
          <div class="metric">
            <div class="metric-label">RESPONSE SIZE</div>
            <div class="metric-value">${responseSize} bytes</div>
          </div>
          <div class="metric">
            <div class="metric-label">CACHE</div>
            <div class="metric-value ${cacheClass}">${cacheStatus}</div>
          </div>
        `;

          if (data.similarity) {
            metricsHTML += `
            <div class="metric">
              <div class="metric-label">SIMILARITY</div>
              <div class="metric-value">${(data.similarity * 100).toFixed(
                1
              )}%</div>
            </div>
          `;
          }

          metricsDiv.innerHTML = metricsHTML;

          // Display response
          responseDiv.innerHTML = `[RESPONSE]\n\n${
            data.response || JSON.stringify(data, null, 2)
          }`;

          // Log request
          logRequest({
            timestamp: new Date().toLocaleTimeString(),
            model,
            cached: data.cached,
            responseTime: `${responseTime}ms`,
            size: `${responseSize}B`,
          });
        } catch (error) {
          const endTime = performance.now();
          const responseTime = (endTime - startTime).toFixed(0);

          metricsDiv.innerHTML = `
          <div class="metric">
            <div class="metric-label">RESPONSE TIME</div>
            <div class="metric-value">${responseTime}ms</div>
          </div>
        `;

          responseDiv.innerHTML = `<span class="error">[ERROR]\n\n${error.message}</span>`;

          logRequest({
            timestamp: new Date().toLocaleTimeString(),
            model,
            cached: false,
            responseTime: `${responseTime}ms`,
            size: "ERROR",
          });
        }
      }

      async function getStats() {
        const apiUrl = document.getElementById("apiUrl").value;
        const statsDiv = document.getElementById("statsContent");

        statsDiv.innerHTML = '<span class="loading">LOADING...</span>';

        try {
          const response = await fetch(`${apiUrl}/stats`);
          const data = await response.json();

          statsDiv.innerHTML = `
          <div class="stat-card">
            <div class="metric-label">CACHE SIZE</div>
            <div class="metric-value">${data.cacheSize || 0}</div>
          </div>
          <div class="stat-card">
            <div class="metric-label">HITS</div>
            <div class="metric-value cache-hit">${data.hits || 0}</div>
          </div>
          <div class="stat-card">
            <div class="metric-label">MISSES</div>
            <div class="metric-value cache-miss">${data.misses || 0}</div>
          </div>
          <div class="stat-card">
            <div class="metric-label">HIT RATE</div>
            <div class="metric-value">${((data.hitRate || 0) * 100).toFixed(
              1
            )}%</div>
          </div>
        `;
        } catch (error) {
          statsDiv.innerHTML = `<span class="error">[ERROR] ${error.message}</span>`;
        }
      }

      async function checkHealth() {
        const apiUrl = document.getElementById("apiUrl").value;
        const statsDiv = document.getElementById("statsContent");

        try {
          const startTime = performance.now();
          const response = await fetch(`${apiUrl}/health`);
          const endTime = performance.now();
          const data = await response.json();

          statsDiv.innerHTML = `
          <div class="stat-card">
            <div class="metric-label">STATUS</div>
            <div class="metric-value cache-hit">${data.status.toUpperCase()}</div>
          </div>
          <div class="stat-card">
            <div class="metric-label">LATENCY</div>
            <div class="metric-value">${(endTime - startTime).toFixed(
              0
            )}ms</div>
          </div>
        `;
        } catch (error) {
          statsDiv.innerHTML = `<span class="error">[ERROR] ${error.message}</span>`;
        }
      }

      function clearResponse() {
        document.getElementById("chatResponse").innerHTML = "";
        document.getElementById("chatMetrics").innerHTML = "";
      }

      function logRequest(request) {
        requestLog.unshift(request);
        if (requestLog.length > 10) requestLog.pop();

        const logDiv = document.getElementById("requestLog");
        const cacheStatus = request.cached ? "HIT" : "MISS";
        const cacheClass = request.cached ? "cache-hit" : "cache-miss";

        logDiv.innerHTML = requestLog
          .map(
            (r) =>
              `[${r.timestamp}] ${r.model} | <span class="${cacheClass}">${
                r.cached ? "HIT" : "MISS"
              }</span> | ${r.responseTime} | ${r.size}`
          )
          .join("\n");
      }

      // Auto-load stats on page load
      window.onload = function () {
        getStats();
      };
    </script>
  </body>
</html>
